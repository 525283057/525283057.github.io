<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 2px solid #000;
        margin: auto;
        background: #FFE597;
    }
    button{
        border-radius: 3px;
        padding:2px 3px;
        border: none;
        background: #f40;
        position: absolute;
        right: 300px;
        bottom: 50px;
    }
</style>
<body>
<button>查看棋谱</button>
<canvas width="600" height="600"></canvas>
<div class="box"></div>
</body>
</html>

<script>
    let canvas = document.querySelector('canvas');
    let ctx = canvas.getContext('2d');
    let drops = {};
    let flag = true;
    //点击画圆
    canvas.onclick = function (e) {
        let ox = Math.floor(e.offsetX / 40);
        let oy = Math.floor(e.offsetY / 40);
        console.log(ox, oy);
        if (drops[m(ox, oy)]) {
            return;
        }
        if (flag) {
            if (check(ox, oy, '#000000') == 5) {
                alert('黑方胜');
            }
            huaQzi(ox, oy, '#000000');
        } else {
            if (check(ox, oy, '#ffffff') == 5) {
                alert('白方胜');
            }
            huaQzi(ox, oy, '#ffffff');
        }
    }

    //棋盘
    Puline();
    function Puline() {
        ctx.clearRect(0, 0, 600, 600);
        ctx.save();
        ctx.beginPath();
        for (let i = 0; i < 15; i++) {
            ctx.moveTo(line(0), line(i));
            ctx.lineTo(line(14), line(i));
            ctx.moveTo(line(i), line(0));
            ctx.lineTo(line(i), line(14));
            ctx.closePath();
            ctx.stroke();

            circle(line(7), line(7));
            circle(line(3), line(3));
            circle(line(11), line(3));
            circle(line(3), line(11));
            circle(line(11), line(11));
        }
    }


    //确定坐标
    function line(x) {
        return 40 * x + 20;
    }
    //画圆
    function circle(x, y) {
        ctx.save();
        ctx.translate(x, y);
        ctx.beginPath();
        ctx.arc(0, 0, 5, 0, Math.PI * 2);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
    }
    //画旗子
    function huaQzi(x, y, color) {
        ctx.save();``
        ctx.translate(line(x), line(y));
        ctx.beginPath();
        ctx.arc(0, 0, 15, 0, Math.PI * 2);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
        ctx.restore();
        flag = !flag;
        drops[m(x, y)] = color;
    }




    //x,y的转换
    function m(x, y) {
        return `${x}_${y}`;
    }


    //胜利方
    function check(x, y, color) {

        //行
        let row = 1,
            i = 1;
        while (drops[m(x + i, y)] == color) {
            row++;
            i++;
        }
        i = 1;
        while (drops[m(x - i, y)] == color) {
            row++;
            i++;
        }
        //列
        let cols = 1;
        i = 1;
        while (drops[m(x, y + i)] == color) {
            cols++;
            i++;
        }
        i = 1;
        while (drops[m(x, y - i)] == color) {
            cols++;
            i++;
        }
        //左斜
        let zx = 1;
        i = 1;
        while (drops[m(x - i, y + i)] == color) {
            zx++;
            i++;
        }
        i = 1;
        while (drops[m(x + i, y - i)] == color) {
            zx++;
            i++;
        }
        //右斜
        let yx = 1;
        i = 1;
        while (drops[m(x + i, y + i)] == color) {
            yx++;
            i++;
        }
        i = 1;
        while (drops[m(x - i, y + i)] == color) {
            yx++;
            i++;
        }
        return Math.max(row, cols, zx, yx);
    }
</script>